<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.555">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Melanie Beebe">

<title>ST558 Homework 4</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="fullcontent">

<div id="quarto-search-results"></div>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">ST558 Homework 4</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Melanie Beebe </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="section" class="level2">
<h2 class="anchored" data-anchor-id="section"></h2>
</section>
<section id="task-1-conceptual-questions" class="level1">
<h1>Task 1: Conceptual Questions</h1>
<ol type="1">
<li><p>i. What is the purpose of the lapply() function?</p>
<blockquote class="blockquote">
<p>lapply() is part of the apply() family of functions and means list apply. lapply() applies a function over a list or vector and is useful when you want to apply a function to each element of a list or vector. lapply() always returns a list.</p>
</blockquote>
<p>ii. What is the equivalent purrr function?</p>
<blockquote class="blockquote">
<p>The equivalent purr function is map().</p>
</blockquote></li>
<li><p>Suppose we have a list called my_list. Each element of the list is a numeric data frame (all columns are numeric). We want use lapply() to run the code cor(numeric_matrix, method = “kendall”) on each element of the list. Write code to do this below!</p>
<blockquote class="blockquote">
<p>lapply(my_list, function(numeric_matrix) cor(numeric_matrix, method = “kendall”))</p>
</blockquote></li>
<li><p>What are two advantages of using purrr functions instead of the BaseR apply family?</p>
<blockquote class="blockquote">
<p>consistency between functions (like order of arguments) and the helpers</p>
</blockquote></li>
<li><p>What is a side-effect function?</p>
<blockquote class="blockquote">
<p>A side effect function is a function that does not modify the data and isn’t returned, but produces something. Examples include loading files, print() and plotting graphics.</p>
</blockquote></li>
<li><p>Why can you name a variable sd in a function and not cause any issues with the sd function?</p>
<blockquote class="blockquote">
<p>A function has it’s own environment so when R is looking for the object it looks in the most local environment which, in this case, is the function environment. As a result, the sd in the function will not overwrite sd in BaseR.</p>
</blockquote></li>
</ol>
</section>
<section id="task-2-writing-r-functions" class="level1">
<h1>Task 2: Writing R Functions</h1>
<section id="question-1" class="level2">
<h2 class="anchored" data-anchor-id="question-1">Question 1</h2>
<section id="write-a-function-for-rmse" class="level3">
<h3 class="anchored" data-anchor-id="write-a-function-for-rmse">Write a function for RMSE</h3>
<p>The goal of this section is to write a function that will take in two vectors and return Root Mean Square Error (RMSE). An ellipsis will be included in the function to allow for additional arguments. The function will be created one or two steps at a time so it can be checked for errors and calculations verified.</p>
<p>The step is to calculate the difference between the response and predicted response, followed by squaring this difference. We can use map2() since we have two vectors as inputs. However, map2() alone will return a list which can cause problems in subsequent steps, so map2_dbl() should be use to return a vector. An anonymous function using x and y is use to calculate the difference between corresponding elements in each vector.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.4     ✔ readr     2.1.5
✔ forcats   1.0.0     ✔ stringr   1.5.1
✔ ggplot2   3.5.1     ✔ tibble    3.2.1
✔ lubridate 1.9.3     ✔ tidyr     1.3.1
✔ purrr     1.0.2     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">#create vectors for testing</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>response_vec <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">20</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>prediction_vec <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">12</span>, <span class="dv">21</span>)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>getRMSE <span class="ot">&lt;-</span> <span class="cf">function</span>(vector1, vector2, ...) {</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">&lt;-</span> <span class="fu">map2_dbl</span>(vector1, vector2, \(x, y) x<span class="sc">-</span>y)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(result)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="fu">getRMSE</span>(response_vec, prediction_vec)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -2 -1</code></pre>
</div>
</div>
<p>The next step is to take the square of the difference for each element in the vector returned from the above function. This step can be accomplished easily with map(). Alternatively, this step could have been performed along with the calculation of differences as one anonymous function, but I chose to keep them separate to verify my code. The function up to this point with the squared differences added is presented below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>getRMSE <span class="ot">&lt;-</span> <span class="cf">function</span>(vector1, vector2, ...) {</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">&lt;-</span> <span class="fu">map2_dbl</span>(vector1, vector2, \(x, y) x<span class="sc">-</span>y) <span class="sc">|&gt;</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map_dbl</span>(\(x) x<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(result)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>squared_differences <span class="ot">&lt;-</span> <span class="fu">getRMSE</span>(response_vec, prediction_vec)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>squared_differences</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4 1</code></pre>
</div>
</div>
<p>The next step is to sum up our squared differences and divide by n, which can be performed using mean(). The next step of taking the square root will also be added using map_dbl(). These steps are also being combined with the previous steps to result in the final function for calculating RMSE.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>getRMSE <span class="ot">&lt;-</span> <span class="cf">function</span>(vector1, vector2, ...) {</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">&lt;-</span> <span class="fu">map2_dbl</span>(vector1, vector2, \(x, y) x<span class="sc">-</span>y) <span class="sc">|&gt;</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map_dbl</span>(\(x) x<span class="sc">^</span><span class="dv">2</span>) <span class="sc">|&gt;</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mean</span>(...) <span class="sc">|&gt;</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map_dbl</span>(\(x) <span class="fu">sqrt</span>(x))</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(result)</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="fu">getRMSE</span>(response_vec, prediction_vec)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.581139</code></pre>
</div>
</div>
</section>
</section>
<section id="question-2" class="level2">
<h2 class="anchored" data-anchor-id="question-2">Question 2</h2>
<section id="create-response-and-prediction-values" class="level3">
<h3 class="anchored" data-anchor-id="create-response-and-prediction-values">Create response and prediction values</h3>
<p>The code for getting a vector for responses and predictions was provide in the homework and is performed below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">10</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">runif</span>(n)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>resp <span class="ot">&lt;-</span> <span class="dv">3</span> <span class="sc">+</span> <span class="dv">10</span><span class="sc">*</span>x <span class="sc">+</span> <span class="fu">rnorm</span>(n)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(<span class="fu">lm</span>(resp <span class="sc">~</span> x), <span class="fu">data.frame</span>(x))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="test-rmse-function" class="level3">
<h3 class="anchored" data-anchor-id="test-rmse-function">Test RMSE function</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">getRMSE</span>(resp, pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.9581677</code></pre>
</div>
</div>
</section>
<section id="repeat-with-missing-values" class="level3">
<h3 class="anchored" data-anchor-id="repeat-with-missing-values">Repeat with missing values</h3>
<p>Now we want to replace two values in the response vector with NA_real_ and run getRMSE with and without specifying missing value behavior in the function. Two values can be replaced by specifying an index. I’ll choose 1:2 so it is easy to view the replacement.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>resp[<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)] <span class="ot">&lt;-</span> <span class="cn">NA_real_</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(resp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]        NA        NA  8.637031 12.068788  4.357179  6.040709</code></pre>
</div>
</div>
</section>
<section id="rmse-function-without-specifying-missing-values-behavior" class="level3">
<h3 class="anchored" data-anchor-id="rmse-function-without-specifying-missing-values-behavior">RMSE function without specifying missing values behavior</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">getRMSE</span>(resp, pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] NA</code></pre>
</div>
</div>
</section>
<section id="rmse-function-specifying-to-ignore-missing-values" class="level3">
<h3 class="anchored" data-anchor-id="rmse-function-specifying-to-ignore-missing-values">RMSE function specifying to ignore missing values</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">getRMSE</span>(resp, pred, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.9661699</code></pre>
</div>
</div>
</section>
</section>
<section id="question-3" class="level2">
<h2 class="anchored" data-anchor-id="question-3">Question 3</h2>
<section id="write-a-function-for-mae" class="level3">
<h3 class="anchored" data-anchor-id="write-a-function-for-mae">Write a function for MAE</h3>
<p>The function for MAE will be similar the one for RMSE. In fact, modifying the RMSE function is the simplest way to go. The difference calculation from RMSE can be modified to take the absolute of the difference. The final step is to sum up the values and divide by n, which is a mean.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>getMAE <span class="ot">&lt;-</span> <span class="cf">function</span>(vector1, vector2, ...) {</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">&lt;-</span> <span class="fu">map2_dbl</span>(vector1, vector2, \(x, y) <span class="fu">abs</span>(x<span class="sc">-</span>y)) <span class="sc">|&gt;</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mean</span>(...)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(result)</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="question-4" class="level2">
<h2 class="anchored" data-anchor-id="question-4">Question 4</h2>
<section id="create-response-values-and-predictions" class="level3">
<h3 class="anchored" data-anchor-id="create-response-values-and-predictions">Create response values and predictions</h3>
<p>This code is the same as for question 2 but it is rerun to overwrite the NA values created previously.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">10</span>)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">runif</span>(n)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>resp <span class="ot">&lt;-</span> <span class="dv">3</span> <span class="sc">+</span> <span class="dv">10</span><span class="sc">*</span>x <span class="sc">+</span> <span class="fu">rnorm</span>(n)</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(<span class="fu">lm</span>(resp <span class="sc">~</span> x), <span class="fu">data.frame</span>(x))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="test-mae-function" class="level3">
<h3 class="anchored" data-anchor-id="test-mae-function">Test MAE function</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">getMAE</span>(resp, pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.8155776</code></pre>
</div>
</div>
</section>
<section id="repeat-mae-function-with-missing-values" class="level3">
<h3 class="anchored" data-anchor-id="repeat-mae-function-with-missing-values">Repeat MAE function with missing values</h3>
<p>Missing values are added as described before.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>resp[<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)] <span class="ot">&lt;-</span> <span class="cn">NA_real_</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(resp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]        NA        NA  8.637031 12.068788  4.357179  6.040709</code></pre>
</div>
</div>
</section>
<section id="test-mae-with-no-arguments-regarding-missing-values-defaults" class="level3">
<h3 class="anchored" data-anchor-id="test-mae-with-no-arguments-regarding-missing-values-defaults">Test MAE with no arguments regarding missing values (defaults)</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">getMAE</span>(resp, pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] NA</code></pre>
</div>
</div>
</section>
<section id="test-mae-specifying-missing-values-to-be-ignored" class="level3">
<h3 class="anchored" data-anchor-id="test-mae-specifying-missing-values-to-be-ignored">Test MAE specifying missing values to be ignored</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">getMAE</span>(resp, pred, <span class="at">na.rm =</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.8241201</code></pre>
</div>
</div>
</section>
</section>
<section id="question-5" class="level2">
<h2 class="anchored" data-anchor-id="question-5">Question 5</h2>
<section id="create-wrapper-function-incorporating-getrmse-and-getmae" class="level3">
<h3 class="anchored" data-anchor-id="create-wrapper-function-incorporating-getrmse-and-getmae">Create wrapper function incorporating getRMSE and getMAE</h3>
<p>To generate a wrapper function that can return both RMSE and MAE or one of the two, we can add an argument called “metrics” that consists of RMSE and MAE as the default. This will result in the return of both calculations as a list. The first requirement for this wrapper function is to check that the input data are numeric vectors. To do so, we can incorporate checks using is.vector( ), is.atomic) and is.numeric(). If the data inputs do not match one or more of these requirements, the function will abort and return that the vector “is not an atomic numeric vector”. To allow the user to specify what calculations they want, we can use a series of if else statements. The first statement is for the default, specifying RMSE and MAE as both being in “metrics”. To return the proper result, it must be one object, so list() is used to return a list containing both RMSE and MAE. The next two if else statements specify what should be returned if RMSE or MAE are specified as a metrics argument when the function is called.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>RMSE_MAE_wrapper <span class="ot">&lt;-</span> <span class="cf">function</span>(vector1, vector2, <span class="at">metrics =</span> <span class="fu">c</span>(<span class="st">"RMSE"</span>, <span class="st">"MAE"</span>), ...) {</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.vector</span>(vector1) <span class="sc">||</span> <span class="sc">!</span><span class="fu">is.atomic</span>(vector1) <span class="sc">||</span> <span class="sc">!</span><span class="fu">is.numeric</span>(vector1)) {</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"vector1 is not an atomic numeric vector"</span>)</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.vector</span>(vector2) <span class="sc">||</span> <span class="sc">!</span><span class="fu">is.atomic</span>(vector2) <span class="sc">||</span> <span class="sc">!</span><span class="fu">is.numeric</span>(vector2)) {</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"vector2 is not an atomic numeric vector"</span>)</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="st">"RMSE"</span> <span class="sc">%in%</span> metrics <span class="sc">&amp;</span> <span class="st">"MAE"</span> <span class="sc">%in%</span> metrics) {</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>    result <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">RMSE =</span> <span class="fu">getRMSE</span>(vector1, vector2, ...), </span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>                   <span class="at">MAE =</span> <span class="fu">getMAE</span>(vector1, vector2, ...))</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span>(<span class="st">"RMSE"</span> <span class="sc">%in%</span> metrics) {</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>    result <span class="ot">&lt;-</span> <span class="fu">getRMSE</span>(vector1, vector2, ...)</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span>(<span class="st">"MAE"</span> <span class="sc">%in%</span> metrics) { </span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>      result <span class="ot">&lt;-</span> <span class="fu">getMAE</span>(vector1, vector2, ...) </span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(result)</span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="question-6" class="level2">
<h2 class="anchored" data-anchor-id="question-6">Question 6</h2>
<section id="create-response-and-prediction-values-1" class="level3">
<h3 class="anchored" data-anchor-id="create-response-and-prediction-values-1">Create response and prediction values</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">10</span>)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">runif</span>(n)</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>resp <span class="ot">&lt;-</span> <span class="dv">3</span> <span class="sc">+</span> <span class="dv">10</span><span class="sc">*</span>x <span class="sc">+</span> <span class="fu">rnorm</span>(n)</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(<span class="fu">lm</span>(resp <span class="sc">~</span> x), <span class="fu">data.frame</span>(x))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="test-wrapper-function-specifying-rmse" class="level3">
<h3 class="anchored" data-anchor-id="test-wrapper-function-specifying-rmse">Test wrapper function specifying RMSE</h3>
<p>Here, we specify RMSE in the metrics argument so that only the calculation for RMSE is returned.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">RMSE_MAE_wrapper</span>(resp, pred, <span class="at">metrics =</span> <span class="st">"RMSE"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.9581677</code></pre>
</div>
</div>
</section>
<section id="test-wrapper-function-specifying-mae" class="level3">
<h3 class="anchored" data-anchor-id="test-wrapper-function-specifying-mae">Test wrapper function specifying MAE</h3>
<p>Here, we specify MAE in the metrics argument so that only the calculation for MAE is returned.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">RMSE_MAE_wrapper</span>(resp, pred, <span class="at">metrics =</span> <span class="st">"MAE"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.8155776</code></pre>
</div>
</div>
</section>
<section id="test-wrapper-function-using-defaults" class="level3">
<h3 class="anchored" data-anchor-id="test-wrapper-function-using-defaults">Test wrapper function using defaults</h3>
<p>Here, we specify nothing for the metrics argument so that the default list containing both RMSE and MAE are in the output.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">RMSE_MAE_wrapper</span>(resp, pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$RMSE
[1] 0.9581677

$MAE
[1] 0.8155776</code></pre>
</div>
</div>
</section>
<section id="repeat-wrapper-test-with-missing-values" class="level3">
<h3 class="anchored" data-anchor-id="repeat-wrapper-test-with-missing-values">Repeat wrapper test with missing values</h3>
<p>The next steps of generating a new response vector with NA for two values is the same as done previously.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>resp[<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)] <span class="ot">&lt;-</span> <span class="cn">NA_real_</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(resp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]        NA        NA  8.637031 12.068788  4.357179  6.040709</code></pre>
</div>
</div>
<p>Next, each of the call variations will be executed.</p>
</section>
<section id="wrapper-with-missing-values-and-specifying-rmse" class="level3">
<h3 class="anchored" data-anchor-id="wrapper-with-missing-values-and-specifying-rmse">Wrapper with missing values and specifying RMSE</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">RMSE_MAE_wrapper</span>(resp, pred, <span class="at">metrics =</span> <span class="st">"RMSE"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] NA</code></pre>
</div>
</div>
</section>
<section id="wrapper-specifying-to-ignore-missing-values-and-calculate-rmse" class="level3">
<h3 class="anchored" data-anchor-id="wrapper-specifying-to-ignore-missing-values-and-calculate-rmse">Wrapper specifying to ignore missing values and calculate RMSE</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">RMSE_MAE_wrapper</span>(resp, pred, <span class="at">metrics =</span> <span class="st">"RMSE"</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.9661699</code></pre>
</div>
</div>
</section>
<section id="wrapper-with-missing-values-and-specifying-mae" class="level3">
<h3 class="anchored" data-anchor-id="wrapper-with-missing-values-and-specifying-mae">Wrapper with missing values and specifying MAE</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">RMSE_MAE_wrapper</span>(resp, pred, <span class="at">metrics =</span> <span class="st">"MAE"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] NA</code></pre>
</div>
</div>
</section>
<section id="wrapper-specifying-to-ignore-missing-values-and-calculate-mae" class="level3">
<h3 class="anchored" data-anchor-id="wrapper-specifying-to-ignore-missing-values-and-calculate-mae">Wrapper specifying to ignore missing values and calculate MAE</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">RMSE_MAE_wrapper</span>(resp, pred, <span class="at">metrics =</span> <span class="st">"MAE"</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.8241201</code></pre>
</div>
</div>
</section>
<section id="wrapper-with-missing-values-using-default-metrics" class="level3">
<h3 class="anchored" data-anchor-id="wrapper-with-missing-values-using-default-metrics">Wrapper with missing values using default metrics</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">RMSE_MAE_wrapper</span>(resp, pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$RMSE
[1] NA

$MAE
[1] NA</code></pre>
</div>
</div>
</section>
<section id="wrapper-specifying-to-ignore-missing-values-and-using-default-metrics" class="level3">
<h3 class="anchored" data-anchor-id="wrapper-specifying-to-ignore-missing-values-and-using-default-metrics">Wrapper specifying to ignore missing values and using default metrics</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">RMSE_MAE_wrapper</span>(resp, pred, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$RMSE
[1] 0.9661699

$MAE
[1] 0.8241201</code></pre>
</div>
</div>
</section>
<section id="test-wrapper-function-with-the-wrong-data-type" class="level3">
<h3 class="anchored" data-anchor-id="test-wrapper-function-with-the-wrong-data-type">Test wrapper function with the wrong data type</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">RMSE_MAE_wrapper</span>(iris, pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in RMSE_MAE_wrapper(iris, pred): vector1 is not an atomic numeric vector</code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="task-3.-querying-and-api-and-tidy_style-function" class="level1">
<h1>Task 3. Querying and API and Tidy_Style Function</h1>
<p>This section requires using newsapi.org to find an interesting topic to query. I chose to query Google Deepmind’s AlphaFold, which predicts the 3D structure of a protein based on its amino acid sequence.</p>
<section id="question-1-1" class="level2">
<h2 class="anchored" data-anchor-id="question-1-1">Question 1</h2>
<p>The following code uses GET() to obtain information about AlphaFold. For creating the URL, I followed guidelines from newsapi.org, using q=AlphaFold, a date of from=2024-05-28 and, following the advice of a classmate, referenced a file for my API key to keep it secure. The paste0() function, which concatenates multiple strings into one string, was used to construct the URL for the query. The structure for GET(url_id) reveals that the raw data is in “content”.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(httr)</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(jsonlite)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'jsonlite'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:purrr':

    flatten</code></pre>
</div>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"api_key.R"</span>)</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>url_id <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"https://newsapi.org/v2/everything?q=AlphaFold&amp;from=2024-05-28&amp;sortBy=popularity&amp;apiKey="</span>, api_key)</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>id_info <span class="ot">&lt;-</span> <span class="fu">GET</span>(url_id)</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(id_info, <span class="at">max.level =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 10
 $ url        : chr "https://newsapi.org/v2/everything?q=AlphaFold&amp;from=2024-05-28&amp;sortBy=popularity&amp;apiKey=2bdcb2ebb22946c2b9407c4ec5ceab21"
 $ status_code: int 200
 $ headers    :List of 14
  ..- attr(*, "class")= chr [1:2] "insensitive" "list"
 $ all_headers:List of 1
 $ cookies    :'data.frame':    0 obs. of  7 variables:
 $ content    : raw [1:72684] 7b 22 73 74 ...
 $ date       : POSIXct[1:1], format: "2024-06-26 02:32:18"
 $ times      : Named num [1:6] 0 0.0289 0.0432 0.0947 0.355 ...
  ..- attr(*, "names")= chr [1:6] "redirect" "namelookup" "connect" "pretransfer" ...
 $ request    :List of 7
  ..- attr(*, "class")= chr "request"
 $ handle     :Class 'curl_handle' &lt;externalptr&gt; 
 - attr(*, "class")= chr "response"</code></pre>
</div>
</div>
</section>
<section id="question-2-1" class="level2">
<h2 class="anchored" data-anchor-id="question-2-1">Question 2</h2>
<p>The raw data will be parsed by accessing content with $content and selecting “articles” from the list, which is where the data frame resides, and converting this to a tibble. The resulting tibble has a source column that contains &lt;data.frame [66 x 2]&gt;. This data frame consists of the source id and name. We want to convert this to a list column. We can modify this using mutate() to replace the source column and convert to a list using apply() with a margin of 1 (for row).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>parsed <span class="ot">&lt;-</span> <span class="fu">fromJSON</span>(<span class="fu">rawToChar</span>(id_info<span class="sc">$</span>content))</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(parsed)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 3
 $ status      : chr "ok"
 $ totalResults: int 77
 $ articles    :'data.frame':   77 obs. of  8 variables:
  ..$ source     :'data.frame': 77 obs. of  2 variables:
  .. ..$ id  : chr [1:77] NA NA NA NA ...
  .. ..$ name: chr [1:77] "Substack.com" "Journal du geek" "Phys.Org" "Phys.Org" ...
  ..$ author     : chr [1:77] "Oleg Trott" "Antoine Gautherie" "Science X" "Marc Zimmer" ...
  ..$ title      : chr [1:77] "Are AlphaFold's new results a miracle?" "La plupart des gens se fiche royalement de ChatGPT, selon une étude" "Reimagining the undergraduate bio lab experience, and keeping students in STEMM" "AI plus gene editing promises to shift biotech into high gear" ...
  ..$ description: chr [1:77] "So this happened: DeepMind (with 48 authors, including a new member of the British nobility) decided to compete"| __truncated__ "L'IA générative est devenue la nouvelle coqueluche de la Big Tech en l'espace de quelques mois, mais le public "| __truncated__ "HHMI's Science Education Alliance is transforming the undergraduate introductory science experience at more tha"| __truncated__ "During her chemistry Nobel Prize lecture in 2018, Frances Arnold said, \"Today we can for all practical purpose"| __truncated__ ...
  ..$ url        : chr [1:77] "https://olegtrott.substack.com/p/are-alphafolds-new-results-a-miracle" "https://www.journaldugeek.com/2024/05/30/la-plupart-des-gens-se-fiche-royalement-de-chatgpt-selon-une-etude/" "https://phys.org/news/2024-06-reimagining-undergraduate-bio-lab-students.html" "https://phys.org/news/2024-06-ai-gene-shift-biotech-high.html" ...
  ..$ urlToImage : chr [1:77] "https://substackcdn.com/image/fetch/w_1200,h_600,c_fill,f_jpg,q_auto:good,fl_progressive:steep,g_auto/https%3A%"| __truncated__ "https://www.journaldugeek.com/app/uploads/2024/05/ia-smartphone.jpg" "https://scx2.b-cdn.net/gfx/news/hires/2024/reimagining-the-underg.jpg" "https://scx2.b-cdn.net/gfx/news/hires/2023/gene-editing-1.jpg" ...
  ..$ publishedAt: chr [1:77] "2024-06-24T15:42:32Z" "2024-05-30T06:12:14Z" "2024-06-07T16:56:01Z" "2024-06-06T17:40:01Z" ...
  ..$ content    : chr [1:77] "So this happened: DeepMind (with 48 authors, including a new member of the British nobility) decided to compete"| __truncated__ "Aujourdhui, tout le monde de la tech na plus que deux mots à la bouche&nbsp;: intelligence artificielle. Il ne se pa"| __truncated__ "This article has been reviewed according to Science&nbsp;X's \r\neditorial process\r\nand policies.\r\nEditors have "| __truncated__ "This article has been reviewed according to Science&nbsp;X's \r\neditorial process\r\nand policies.\r\nEditors have "| __truncated__ ...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>alphafold_info <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(parsed<span class="sc">$</span>articles) </span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>alphafold_info</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 77 × 8
   source$id $name author title description url   urlToImage publishedAt content
   &lt;chr&gt;     &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt;      &lt;chr&gt;       &lt;chr&gt;  
 1 &lt;NA&gt;      Subs… Oleg … "Are… "So this h… http… https://s… 2024-06-24… "So th…
 2 &lt;NA&gt;      Jour… Antoi… "La … "L'IA géné… http… https://w… 2024-05-30… "Aujou…
 3 &lt;NA&gt;      Phys… Scien… "Rei… "HHMI's Sc… http… https://s… 2024-06-07… "This …
 4 &lt;NA&gt;      Phys… Marc … "AI … "During he… http… https://s… 2024-06-06… "This …
 5 &lt;NA&gt;      Phys… Kathe… "Key… "The lengt… http… https://s… 2024-06-05… "This …
 6 &lt;NA&gt;      Nati… Danie… "Alp… "Vivimos e… http… https://c… 2024-06-12… "Vivim…
 7 &lt;NA&gt;      Tinh… no-re… "Bên… "Phòng lab… http… https://s… 2024-06-21… "iu qu…
 8 &lt;NA&gt;      Inte… Inter…  &lt;NA&gt; "Biologia … http… https://m… 2024-06-20… "Biolo…
 9 &lt;NA&gt;      Cour… &lt;NA&gt;   "L’I… "Après avo… http… https://f… 2024-06-14… "Avec …
10 &lt;NA&gt;      Tech… Alain… " Ce… "DeepMind … http… https://s… 2024-05-29… "DeepM…
# ℹ 67 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>alphafold_info <span class="sc">|&gt;</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">source =</span> <span class="fu">apply</span>(source, <span class="at">MARGIN =</span> <span class="dv">1</span>, as.list))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 77 × 8
   source       author    title description url   urlToImage publishedAt content
   &lt;named list&gt; &lt;chr&gt;     &lt;chr&gt; &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt;      &lt;chr&gt;       &lt;chr&gt;  
 1 &lt;named list&gt; Oleg Tro… "Are… "So this h… http… https://s… 2024-06-24… "So th…
 2 &lt;named list&gt; Antoine … "La … "L'IA géné… http… https://w… 2024-05-30… "Aujou…
 3 &lt;named list&gt; Science X "Rei… "HHMI's Sc… http… https://s… 2024-06-07… "This …
 4 &lt;named list&gt; Marc Zim… "AI … "During he… http… https://s… 2024-06-06… "This …
 5 &lt;named list&gt; Katherin… "Key… "The lengt… http… https://s… 2024-06-05… "This …
 6 &lt;named list&gt; Daniel P… "Alp… "Vivimos e… http… https://c… 2024-06-12… "Vivim…
 7 &lt;named list&gt; no-reply… "Bên… "Phòng lab… http… https://s… 2024-06-21… "iu qu…
 8 &lt;named list&gt; Internaz…  &lt;NA&gt; "Biologia … http… https://m… 2024-06-20… "Biolo…
 9 &lt;named list&gt; &lt;NA&gt;      "L’I… "Après avo… http… https://f… 2024-06-14… "Avec …
10 &lt;named list&gt; Alain RE… " Ce… "DeepMind … http… https://s… 2024-05-29… "DeepM…
# ℹ 67 more rows</code></pre>
</div>
</div>
</section>
<section id="question-3-1" class="level2">
<h2 class="anchored" data-anchor-id="question-3-1">Question 3</h2>
<p>The goal here is to write a function that can query newsapi.org. The function will take in arguments “subject”, for the topic of interest and “start_date” for the “&amp;from” portion of the URL which specifies the date from which to start the search. There is also an “api_key” argument, but the function is designed with the intent that the user stores their key in a file called api_key.R for security purposes, so “api_key” will always used for this argument. The URL is constructed based on the user’s input arguments using paste0(). If we had wanted to hardcode the API key, the function would be the same but the source(“api_key.R) line would be removed from the function code and the user would replace the api_key argument with their own API key when they call the function. The rest of the code is the same as above. One caveat with the date is that the user may not specify the correct format for date, so code could be added to the function to account for this (I couldn’t figure this out) or a comment can be added within the function to specify the date format. Another potential issue is if someone wants to enter a subject with two words. For the function to work properly, the URL needs to be constructed so that a space in the form of”%20” is added between the words. A Google search turned up the function gsub(), so that is incorporated into the function to allow for a subject argument with more than one word. This function takes in the pattern, replacement and x (subject in our case). The complete function is presented below and was tested on the AlphaFold query. Returned results were the same as obtained previously.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>api_query <span class="ot">&lt;-</span> <span class="cf">function</span>(subject, <span class="at">start_date =</span> <span class="st">"2024-01-25"</span>, api_key) {</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">#subject: topic to search for</span></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">#start_date: starting date for news search in "YYYY-MM-DD" format</span></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">#api-key: API key for accessing API at newsapi.org, stored securely </span></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">#in a api.key.R file</span></span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>  subject <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">" "</span>, <span class="st">"%20"</span>, subject)</span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">source</span>(<span class="st">"api_key.R"</span>)</span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>  url_id <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"https://newsapi.org/v2/everything?q="</span>, subject,</span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"&amp;from="</span>, start_date, <span class="st">"&amp;sortBy=popularity&amp;apiKey="</span>, api_key)</span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a>  id_info <span class="ot">&lt;-</span> <span class="fu">GET</span>(url_id)</span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a>  parsed <span class="ot">&lt;-</span> <span class="fu">fromJSON</span>(<span class="fu">rawToChar</span>(id_info<span class="sc">$</span>content))</span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(parsed<span class="sc">$</span>articles) <span class="sc">|&gt;</span></span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">source =</span> <span class="fu">apply</span>(source, <span class="at">MARGIN =</span> <span class="dv">1</span>, as.list))</span>
<span id="cb63-14"><a href="#cb63-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(result)</span>
<span id="cb63-15"><a href="#cb63-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb63-16"><a href="#cb63-16" aria-hidden="true" tabindex="-1"></a><span class="co">#test</span></span>
<span id="cb63-17"><a href="#cb63-17" aria-hidden="true" tabindex="-1"></a><span class="co">#api_query("AlphaFold", "2024-05-28", api_key)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="run-api-function-two-times" class="level3">
<h3 class="anchored" data-anchor-id="run-api-function-two-times">Run API function two times</h3>
<p>The API function will first be tested by searching for Altera, which is start-up company working on AI that can play video games with real players.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">api_query</span>(<span class="st">"Altera"</span>, <span class="st">"2024-05-26"</span>, api_key)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 100 × 8
   source       author    title description url   urlToImage publishedAt content
   &lt;named list&gt; &lt;chr&gt;     &lt;chr&gt; &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt;      &lt;chr&gt;       &lt;chr&gt;  
 1 &lt;named list&gt; Maya Pos… "Fix… "One excit… http… https://h… 2024-06-10… "Using…
 2 &lt;named list&gt; Azucena … "Est… "El enjuag… http… https://i… 2024-06-05… "El en…
 3 &lt;named list&gt; Pablo Ma… "En … "La tecnol… http… https://i… 2024-06-05… "La te…
 4 &lt;named list&gt; Matías S… "El … "Desde que… http… https://i… 2024-06-17… "Desde…
 5 &lt;named list&gt; Javier M… "Rus… "En febrer… http… https://i… 2024-06-05… "En fe…
 6 &lt;named list&gt; Carlos P… "He … "— ¿Qué ho… http… https://i… 2024-06-16… "¿Qué …
 7 &lt;named list&gt; &lt;NA&gt;      "Fix… "Comments"  http… &lt;NA&gt;       2024-06-09… "What …
 8 &lt;named list&gt; Pablo Mo… "¿Ti… "La socied… http… https://i… 2024-05-28… "Estás…
 9 &lt;named list&gt; Sarah Ro… "¿Cu… "La Tierra… http… https://i… 2024-06-05… "Un eq…
10 &lt;named list&gt; Iván Gon… "\"S… "Aunque la… http… https://i… 2024-06-12… "Aunqu…
# ℹ 90 more rows</code></pre>
</div>
</div>
<p>Next, the API function will be tested on “behavioral nudge”, inspired by an article in The Wall Street Journal about nudging people in the right direction for better decision making.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">api_query</span>(<span class="st">"behavioral nudge"</span>, <span class="st">"2024-05-26"</span>, api_key)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 16 × 8
   source       author    title description url   urlToImage publishedAt content
   &lt;named list&gt; &lt;chr&gt;     &lt;chr&gt; &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt;      &lt;chr&gt;       &lt;chr&gt;  
 1 &lt;named list&gt; Justin W… Cons… "A new sur… http… https://a… 2024-06-07… "One o…
 2 &lt;named list&gt; Ben Math… Poli… "New, surp… http… https://c… 2024-06-20… "In la…
 3 &lt;named list&gt; 26258821… Hope… "Dave Snow… http… https://g… 2024-06-21… "This …
 4 &lt;named list&gt; Sarang S… AI H… "AI Househ… http… https://w… 2024-06-03… "Of al…
 5 &lt;named list&gt; Katherin… Lovi… "Recovery … http… https://c… 2024-06-19… "This …
 6 &lt;named list&gt; Evan Pol… The … "The benef… http… https://s… 2024-05-26… "Behav…
 7 &lt;named list&gt; Elizabet… Gove… "The obsta… http… https://d… 2024-06-11… "Is th…
 8 &lt;named list&gt; Jenna Ab… Goog… "In 2021, … http… https://i… 2024-05-31… "In 20…
 9 &lt;named list&gt; &lt;NA&gt;      Comm… "html {\n … http… &lt;NA&gt;       2024-05-26… "This …
10 &lt;named list&gt; Transfor… Leve… "Integrati… http… &lt;NA&gt;       2024-06-02… "\"The…
11 &lt;named list&gt; communit… Do Y… "Editor's … http… https://m… 2024-06-03… "Merco…
12 &lt;named list&gt; Nicole C… My H… "He compla… http… https://c… 2024-06-13… "Care …
13 &lt;named list&gt; Sara Hea… What… "Behaviora… http… https://c… 2024-05-30… "Why d…
14 &lt;named list&gt; &lt;NA&gt;      [Rem… "[Removed]" http… &lt;NA&gt;       1970-01-01… "[Remo…
15 &lt;named list&gt; Amy Roed… Can … "Hayami Ko… http… https://w… 2024-05-31… "Hayam…
16 &lt;named list&gt; &lt;NA&gt;      Nudg… "Banerjee,… http… &lt;NA&gt;       2024-06-24… "Baner…</code></pre>
</div>
</div>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>